<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOSSIER AUDIO ‚Äî Document Classifi√©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Courier+Prime:wght@400;700&family=Caveat:wght@400;700&display=swap');
        
        :root {
            --paper-bg: #f4f1e8;
            --paper-aged: #e8e4d4;
            --ink-black: #1a1a1a;
            --ink-faded: #4a4a4a;
            --stamp-red: #c41e3a;
            --stamp-blue: #1e4a7c;
            --highlight-yellow: rgba(255, 230, 0, 0.4);
            --tape-color: rgba(255, 248, 220, 0.7);
            --coffee-stain: rgba(139, 90, 43, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #2a2a2a;
            background-image: 
                radial-gradient(ellipse at center, #3a3a3a 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            font-family: 'Courier Prime', monospace;
        }

        /* DOSSIER CONTAINER */
        .dossier {
            width: 100%;
            max-width: 700px;
            background: var(--paper-bg);
            position: relative;
            padding: 40px 50px 50px;
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.5),
                0 0 0 1px rgba(0,0,0,0.1);
            
            /* Paper texture */
            background-image: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"),
                linear-gradient(180deg, var(--paper-bg) 0%, var(--paper-aged) 100%);
        }

        /* FOLDER TAB */
        .dossier::before {
            content: "CONFIDENTIEL";
            position: absolute;
            top: -25px;
            left: 40px;
            background: #d4c4a8;
            padding: 8px 25px 12px;
            font-family: 'Special Elite', monospace;
            font-size: 0.75rem;
            letter-spacing: 3px;
            color: var(--stamp-red);
            border-radius: 5px 5px 0 0;
            box-shadow: inset 0 -5px 10px rgba(0,0,0,0.1);
        }

        /* COFFEE STAIN */
        .dossier::after {
            content: "";
            position: absolute;
            top: 60px;
            right: 40px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, 
                transparent 30%, 
                var(--coffee-stain) 40%, 
                transparent 50%,
                var(--coffee-stain) 60%,
                transparent 70%
            );
            transform: rotate(-15deg);
            pointer-events: none;
        }

        /* TAPE STRIPS */
        .tape {
            position: absolute;
            background: var(--tape-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tape-top {
            width: 120px;
            height: 30px;
            top: -10px;
            right: 80px;
            transform: rotate(-3deg);
        }

        .tape-corner {
            width: 60px;
            height: 25px;
            bottom: 20px;
            left: -10px;
            transform: rotate(45deg);
        }

        /* HEADER */
        .dossier-header {
            border-bottom: 2px solid var(--ink-black);
            padding-bottom: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .classification {
            display: inline-block;
            border: 3px solid var(--stamp-red);
            padding: 5px 15px;
            font-family: 'Special Elite', monospace;
            font-size: 0.85rem;
            color: var(--stamp-red);
            transform: rotate(-2deg);
            position: absolute;
            top: 0;
            right: 0;
        }

        .dossier-title {
            font-family: 'Special Elite', monospace;
            font-size: 1.5rem;
            color: var(--ink-black);
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .dossier-ref {
            font-size: 0.75rem;
            color: var(--ink-faded);
            letter-spacing: 1px;
        }

        /* STAMPS */
        .stamp {
            position: absolute;
            font-family: 'Special Elite', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 8px 15px;
            border: 3px solid;
            border-radius: 3px;
            transform: rotate(-12deg);
            opacity: 0.8;
        }

        .stamp-approved {
            color: var(--stamp-blue);
            border-color: var(--stamp-blue);
            top: 80px;
            right: 30px;
            font-size: 0.7rem;
        }

        .stamp-date {
            position: absolute;
            font-family: 'Special Elite', monospace;
            font-size: 0.65rem;
            color: var(--ink-faded);
            bottom: 15px;
            right: 50px;
            transform: rotate(-5deg);
        }

        /* FORM FIELDS */
        .field-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .field {
            flex: 1;
        }

        .field-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--ink-faded);
            margin-bottom: 4px;
        }

        .field-value {
            font-family: 'Courier Prime', monospace;
            font-size: 1rem;
            color: var(--ink-black);
            border-bottom: 1px solid var(--ink-faded);
            padding: 5px 0;
            min-height: 30px;
        }

        .field-value.handwritten {
            font-family: 'Caveat', cursive;
            font-size: 1.3rem;
            color: #1e3a5f;
        }

        /* AUDIO SECTION */
        .audio-section {
            background: rgba(0,0,0,0.03);
            border: 1px dashed var(--ink-faded);
            padding: 20px;
            margin: 25px 0;
            position: relative;
        }

        .section-label {
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--paper-bg);
            padding: 0 10px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--ink-faded);
        }

        /* REEL DISPLAY */
        .reel-display {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin: 20px 0;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 5px;
            position: relative;
        }

        .reel {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: 
                radial-gradient(circle at center, #333 0%, #1a1a1a 30%),
                conic-gradient(from 0deg, 
                    #444 0deg, #222 30deg, 
                    #444 60deg, #222 90deg,
                    #444 120deg, #222 150deg,
                    #444 180deg, #222 210deg,
                    #444 240deg, #222 270deg,
                    #444 300deg, #222 330deg,
                    #444 360deg
                );
            border: 4px solid #555;
            box-shadow: 
                inset 0 0 30px rgba(0,0,0,0.5),
                0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }

        .reel::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            border: 2px solid #888;
        }

        .playing .reel {
            animation: reel-spin 2s linear infinite;
        }

        @keyframes reel-spin {
            100% { transform: rotate(360deg); }
        }

        .tape-path {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                #8b4513 10%, 
                #8b4513 90%, 
                transparent 100%
            );
        }

        .counter-display {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-family: 'Courier Prime', monospace;
            font-size: 1.2rem;
            color: #ff3300;
            text-shadow: 0 0 5px #ff3300;
            letter-spacing: 2px;
        }

        /* WAVEFORM */
        .waveform-section {
            margin: 20px 0;
            position: relative;
        }

        .waveform-bg {
            height: 60px;
            background: 
                repeating-linear-gradient(
                    90deg,
                    var(--paper-aged) 0px,
                    var(--paper-aged) 1px,
                    transparent 1px,
                    transparent 10px
                ),
                repeating-linear-gradient(
                    0deg,
                    rgba(0,0,0,0.05) 0px,
                    rgba(0,0,0,0.05) 1px,
                    transparent 1px,
                    transparent 10px
                );
            border: 1px solid var(--ink-faded);
            position: relative;
            cursor: crosshair;
        }

        .waveform-drawn {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
        }

        .progress-marker {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: var(--stamp-red);
            box-shadow: 0 0 5px var(--stamp-red);
        }

        .time-markers {
            display: flex;
            justify-content: space-between;
            font-size: 0.6rem;
            color: var(--ink-faded);
            margin-top: 5px;
        }

        /* CONTROLS */
        .controls-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .ctrl-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--ink-black);
            background: var(--paper-bg);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 3px 0 var(--ink-faded),
                0 5px 10px rgba(0,0,0,0.1);
        }

        .ctrl-btn:hover {
            background: var(--paper-aged);
        }

        .ctrl-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }

        .ctrl-btn.play-btn {
            width: 70px;
            height: 70px;
            border-width: 3px;
            font-size: 1.5rem;
        }

        .ctrl-btn.play-btn.active {
            background: var(--stamp-red);
            color: white;
            border-color: var(--stamp-red);
        }

        /* ANNOTATIONS */
        .annotation {
            font-family: 'Caveat', cursive;
            color: #1e3a5f;
            position: absolute;
        }

        .annotation-1 {
            top: 150px;
            left: -20px;
            transform: rotate(-90deg);
            font-size: 0.9rem;
        }

        .annotation-2 {
            bottom: 120px;
            right: 20px;
            font-size: 1.1rem;
            transform: rotate(3deg);
        }

        .arrow-annotation {
            position: absolute;
            font-family: 'Caveat', cursive;
            color: var(--stamp-red);
            font-size: 0.85rem;
        }

        /* HIGHLIGHT */
        .highlight {
            background: var(--highlight-yellow);
            padding: 0 3px;
        }

        /* NOTES SECTION */
        .notes-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--ink-faded);
        }

        .notes-title {
            font-family: 'Special Elite', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--ink-faded);
            margin-bottom: 15px;
        }

        .notes-content {
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            color: #1e3a5f;
            line-height: 1.8;
        }

        .strikethrough {
            text-decoration: line-through;
            color: var(--ink-faded);
        }

        /* CHECKBOX */
        .checkbox-row {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: var(--ink-faded);
        }

        .checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid var(--ink-faded);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Caveat', cursive;
            font-size: 1.2rem;
            color: #1e3a5f;
        }

        /* FOOTER */
        .dossier-footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid var(--ink-black);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .signature-area {
            text-align: center;
        }

        .signature-line {
            width: 150px;
            border-bottom: 1px solid var(--ink-black);
            margin-bottom: 5px;
        }

        .signature {
            font-family: 'Caveat', cursive;
            font-size: 1.5rem;
            color: #1e3a5f;
            transform: rotate(-5deg);
            display: inline-block;
        }

        .signature-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
        }

        .barcode {
            font-family: 'Libre Barcode 39', monospace;
            font-size: 2rem;
            letter-spacing: -2px;
        }

        /* PLAYLIST ATTACHMENTS */
        .attachments {
            margin-top: 20px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px dashed var(--ink-faded);
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .attachment-item:hover {
            background: rgba(0,0,0,0.03);
        }

        .attachment-item.active {
            background: var(--highlight-yellow);
        }

        .attachment-icon {
            width: 30px;
            height: 30px;
            background: var(--ink-faded);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            margin-right: 15px;
        }

        .attachment-info {
            flex: 1;
        }

        .attachment-name {
            font-family: 'Special Elite', monospace;
            font-size: 0.85rem;
            color: var(--ink-black);
        }

        .attachment-meta {
            font-size: 0.65rem;
            color: var(--ink-faded);
            margin-top: 3px;
        }

        .attachment-duration {
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            color: var(--ink-faded);
        }

        /* STATUS LOG */
        .status-log {
            font-family: 'Courier Prime', monospace;
            font-size: 0.7rem;
            color: var(--ink-faded);
            background: rgba(0,0,0,0.02);
            padding: 10px;
            margin-top: 15px;
            border-left: 3px solid var(--ink-faded);
        }

        #statusText {
            color: var(--stamp-blue);
        }

        /* VOLUME */
        .volume-section {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .volume-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
        }

        .volume-slider {
            -webkit-appearance: none;
            width: 120px;
            height: 8px;
            background: var(--paper-aged);
            border: 1px solid var(--ink-faded);
            border-radius: 4px;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--ink-black);
            border-radius: 50%;
            cursor: pointer;
        }

        /* RESPONSIVE */
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            .dossier {
                padding: 30px 25px 40px;
            }
            .reel-display {
                gap: 20px;
            }
            .reel {
                width: 70px;
                height: 70px;
            }
            .field-row {
                flex-direction: column;
                gap: 10px;
            }
            .annotation {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="dossier" id="dossier">
    <!-- Tape strips -->
    <div class="tape tape-top"></div>
    <div class="tape tape-corner"></div>
    
    <!-- Stamps -->
    <div class="stamp stamp-approved">V√âRIFI√â</div>
    <div class="stamp-date">03/02/2026</div>
    
    <!-- Annotations -->
    <div class="annotation annotation-1">‚Üí priorit√© haute</div>
    <div class="annotation annotation-2">√Ä diffuser !</div>

    <!-- HEADER -->
    <div class="dossier-header">
        <div class="classification">NIVEAU 3</div>
        <h1 class="dossier-title">DOSSIER AUDIO</h1>
        <div class="dossier-ref">R√âF: CCPLC-2026-<span id="refNumber">0042</span> // VEILLE CITOYENNE</div>
    </div>

    <!-- FORM FIELDS -->
    <div class="field-row">
        <div class="field">
            <div class="field-label">Objet</div>
            <div class="field-value" id="trackTitle">PARTY ON GAME OVER</div>
        </div>
        <div class="field">
            <div class="field-label">Source</div>
            <div class="field-value handwritten" id="trackSource">CCPLC Broadcast</div>
        </div>
    </div>

    <div class="field-row">
        <div class="field">
            <div class="field-label">Date d'interception</div>
            <div class="field-value handwritten">03 f√©vrier 2026</div>
        </div>
        <div class="field">
            <div class="field-label">Dur√©e</div>
            <div class="field-value" id="durationField">--:--</div>
        </div>
    </div>

    <!-- AUDIO SECTION -->
    <div class="audio-section">
        <span class="section-label">Enregistrement magn√©tique</span>
        
        <!-- REEL DISPLAY -->
        <div class="reel-display" id="reelDisplay">
            <div class="reel" id="reelLeft"></div>
            <div class="tape-path"></div>
            <div class="reel" id="reelRight"></div>
            <div class="counter-display" id="counterDisplay">000</div>
        </div>

        <!-- WAVEFORM -->
        <div class="waveform-section">
            <div class="waveform-bg" id="waveformBg">
                <canvas class="waveform-drawn" id="waveformCanvas"></canvas>
                <div class="progress-marker" id="progressMarker"></div>
            </div>
            <div class="time-markers">
                <span id="timeCurrent">00:00</span>
                <span id="timeTotal">00:00</span>
            </div>
        </div>

        <!-- CONTROLS -->
        <div class="controls-row">
            <button class="ctrl-btn" id="btnPrev" title="Pr√©c√©dent">‚èÆ</button>
            <button class="ctrl-btn" id="btnRew" title="Reculer">‚è™</button>
            <button class="ctrl-btn play-btn" id="btnPlay" title="Lecture">‚ñ∂</button>
            <button class="ctrl-btn" id="btnFwd" title="Avancer">‚è©</button>
            <button class="ctrl-btn" id="btnNext" title="Suivant">‚è≠</button>
        </div>

        <!-- VOLUME -->
        <div class="volume-section">
            <span class="volume-label">Volume</span>
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
        </div>
    </div>

    <!-- ATTACHMENTS / PLAYLIST -->
    <div class="attachments">
        <div class="notes-title">Documents joints (cliquer pour charger)</div>
        <div id="playlistContainer">
            <!-- Generated by JS -->
        </div>
    </div>

    <!-- NOTES -->
    <div class="notes-section">
        <div class="notes-title">Notes de l'agent</div>
        <div class="notes-content">
            Transmission <span class="highlight">intercept√©e</span> sur la fr√©quence 106.1 FM.<br>
            Contenu : <span class="strikethrough">propagande</span> information citoyenne.<br>
            Recommandation : <span class="highlight">diffusion large</span> recommand√©e.
        </div>
        
        <div class="checkbox-row">
            <div class="checkbox-item">
                <div class="checkbox">‚úì</div>
                <span>Authentifi√©</span>
            </div>
            <div class="checkbox-item">
                <div class="checkbox">‚úì</div>
                <span>Transcrit</span>
            </div>
            <div class="checkbox-item">
                <div class="checkbox"></div>
                <span>Archiv√©</span>
            </div>
        </div>
    </div>

    <!-- STATUS -->
    <div class="status-log">
        STATUT : <span id="statusText">EN ATTENTE</span>
    </div>

    <!-- FOOTER -->
    <div class="dossier-footer">
        <div class="signature-area">
            <div class="signature-line">
                <span class="signature">ouaisfieu</span>
            </div>
            <div class="signature-label">Signature de l'agent</div>
        </div>
        <div>
            <div style="font-family: 'Libre Barcode 39', monospace; font-size: 1.5rem;">*CCPLC2026*</div>
            <div style="font-size: 0.55rem; color: var(--ink-faded); text-align: right;">CC BY-NC 4.0</div>
        </div>
    </div>
</div>

<audio id="audioPlayer" preload="metadata"></audio>

<script>
// ========================================
// DOSSIER AUDIO - ENGINE
// ========================================

const playlist = [
    {
        title: "PARTY ON GAME OVER",
        source: "CCPLC Broadcast",
        src: "https://dl.ouaisfi.eu/ccplc/test-o/party-on-game-over.mp3",
        ref: "0042",
        duration: "05:02"
    },
    {
        title: "BULLETIN D'ALERTE SOCIALE",
        source: "R√©seau 11¬∑60",
        src: "https://dl.ouaisfi.eu/ccplc/test-o/party-on-game-over.mp3",
        ref: "0043",
        duration: "03:45"
    },
    {
        title: "D√âBRIEFING ‚Äî MISSION CIVIQUE",
        source: "Cellule Alpha",
        src: "https://dl.ouaisfi.eu/ccplc/test-o/party-on-game-over.mp3",
        ref: "0044",
        duration: "08:30"
    }
];

// DOM
const audio = document.getElementById('audioPlayer');
const dossier = document.getElementById('dossier');
const reelDisplay = document.getElementById('reelDisplay');
const btnPlay = document.getElementById('btnPlay');
const btnPrev = document.getElementById('btnPrev');
const btnNext = document.getElementById('btnNext');
const btnRew = document.getElementById('btnRew');
const btnFwd = document.getElementById('btnFwd');
const volumeSlider = document.getElementById('volumeSlider');
const trackTitle = document.getElementById('trackTitle');
const trackSource = document.getElementById('trackSource');
const timeCurrent = document.getElementById('timeCurrent');
const timeTotal = document.getElementById('timeTotal');
const durationField = document.getElementById('durationField');
const progressMarker = document.getElementById('progressMarker');
const waveformBg = document.getElementById('waveformBg');
const waveformCanvas = document.getElementById('waveformCanvas');
const counterDisplay = document.getElementById('counterDisplay');
const playlistContainer = document.getElementById('playlistContainer');
const statusText = document.getElementById('statusText');
const refNumber = document.getElementById('refNumber');

// State
let currentTrack = 0;
let isPlaying = false;

// Init
function init() {
    renderPlaylist();
    loadTrack(currentTrack);
    drawWaveform();
    setupEventListeners();
    audio.volume = volumeSlider.value / 100;
    setStatus("EN ATTENTE DE LECTURE");
}

// Render playlist
function renderPlaylist() {
    playlistContainer.innerHTML = '';
    playlist.forEach((track, index) => {
        const item = document.createElement('div');
        item.className = `attachment-item ${index === currentTrack ? 'active' : ''}`;
        item.innerHTML = `
            <div class="attachment-icon">üìº</div>
            <div class="attachment-info">
                <div class="attachment-name">${track.title}</div>
                <div class="attachment-meta">${track.source} ‚Äî R√âF: ${track.ref}</div>
            </div>
            <div class="attachment-duration">${track.duration}</div>
        `;
        item.addEventListener('click', () => {
            currentTrack = index;
            loadTrack(currentTrack);
            play();
        });
        playlistContainer.appendChild(item);
    });
}

// Load track
function loadTrack(index) {
    const track = playlist[index];
    audio.src = track.src;
    trackTitle.textContent = track.title;
    trackSource.textContent = track.source;
    refNumber.textContent = track.ref;
    durationField.textContent = track.duration;
    
    // Update playlist UI
    document.querySelectorAll('.attachment-item').forEach((item, i) => {
        item.classList.toggle('active', i === index);
    });
    
    setStatus(`CHARGEMENT: ${track.title}`);
}

// Draw waveform
function drawWaveform() {
    const ctx = waveformCanvas.getContext('2d');
    const w = waveformCanvas.width = waveformBg.offsetWidth;
    const h = waveformCanvas.height = waveformBg.offsetHeight;
    
    ctx.strokeStyle = '#4a4a4a';
    ctx.lineWidth = 1;
    ctx.beginPath();
    
    for (let x = 0; x < w; x += 3) {
        const amp = Math.random() * 0.6 + 0.2;
        const y1 = (h / 2) - (amp * h * 0.4);
        const y2 = (h / 2) + (amp * h * 0.4);
        ctx.moveTo(x, y1);
        ctx.lineTo(x, y2);
    }
    
    ctx.stroke();
}

// Play/Pause
function togglePlay() {
    if (audio.paused) {
        play();
    } else {
        pause();
    }
}

function play() {
    audio.play().then(() => {
        isPlaying = true;
        btnPlay.textContent = '‚è∏';
        btnPlay.classList.add('active');
        reelDisplay.classList.add('playing');
        setStatus("LECTURE EN COURS...");
    }).catch(err => {
        setStatus("ERREUR: " + err.message);
    });
}

function pause() {
    audio.pause();
    isPlaying = false;
    btnPlay.textContent = '‚ñ∂';
    btnPlay.classList.remove('active');
    reelDisplay.classList.remove('playing');
    setStatus("PAUSE");
}

// Format time
function formatTime(seconds) {
    if (isNaN(seconds)) return "00:00";
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}

// Navigation
function prevTrack() {
    currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
    loadTrack(currentTrack);
    if (isPlaying) play();
}

function nextTrack() {
    currentTrack = (currentTrack + 1) % playlist.length;
    loadTrack(currentTrack);
    if (isPlaying) play();
}

// Status
function setStatus(msg) {
    statusText.textContent = msg;
}

// Event listeners
function setupEventListeners() {
    btnPlay.addEventListener('click', togglePlay);
    btnPrev.addEventListener('click', prevTrack);
    btnNext.addEventListener('click', nextTrack);
    btnRew.addEventListener('click', () => { audio.currentTime -= 10; });
    btnFwd.addEventListener('click', () => { audio.currentTime += 10; });
    
    volumeSlider.addEventListener('input', (e) => {
        audio.volume = e.target.value / 100;
    });
    
    // Time update
    audio.addEventListener('timeupdate', () => {
        const { currentTime, duration } = audio;
        timeCurrent.textContent = formatTime(currentTime);
        timeTotal.textContent = formatTime(duration);
        
        // Progress
        const percent = (currentTime / duration) * 100 || 0;
        progressMarker.style.left = `${percent}%`;
        
        // Counter
        counterDisplay.textContent = String(Math.floor(currentTime)).padStart(3, '0');
    });
    
    // Click on waveform
    waveformBg.addEventListener('click', (e) => {
        const rect = waveformBg.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        audio.currentTime = percent * audio.duration;
    });
    
    // Loaded
    audio.addEventListener('loadedmetadata', () => {
        timeTotal.textContent = formatTime(audio.duration);
        durationField.textContent = formatTime(audio.duration);
        drawWaveform();
    });
    
    // Ended
    audio.addEventListener('ended', () => {
        setStatus("LECTURE TERMIN√âE");
        nextTrack();
    });
    
    // Error
    audio.addEventListener('error', () => {
        setStatus("ERREUR: FICHIER INACCESSIBLE");
    });
    
    // Keyboard
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
            e.preventDefault();
            togglePlay();
        }
    });
}

// Resize
window.addEventListener('resize', drawWaveform);

// Start
init();
</script>

</body>
</html>
